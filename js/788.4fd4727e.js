(self["webpackChunkchat"]=self["webpackChunkchat"]||[]).push([[788],{7045:function(e,t,s){var a=s(6339),n=s(3070);e.exports=function(e,t,s){return s.get&&a(s.get,t,{getter:!0}),s.set&&a(s.set,t,{setter:!0}),n.f(e,t,s)}},7066:function(e,t,s){"use strict";var a=s(9670);e.exports=function(){var e=a(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t}},2087:function(e,t,s){var a=s(7854),n=s(9781),o=s(7045),i=s(7066),r=s(7293),l=a.RegExp,c=l.prototype,h=n&&r((function(){var e=!0;try{l(".","d")}catch(h){e=!1}var t={},s="",a=e?"dgimsy":"gimsy",n=function(e,a){Object.defineProperty(t,e,{get:function(){return s+=a,!0}})},o={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var i in e&&(o.hasIndices="d"),o)n(i,o[i]);var r=Object.getOwnPropertyDescriptor(c,"flags").get.call(t);return r!==a||s!==a}));h&&o(c,"flags",{configurable:!0,get:i})},788:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return A}});var a=s(3396);const n={id:"chat"};function o(e,t,s,o,i,r){const l=(0,a.up)("ChatMessage");return(0,a.wg)(),(0,a.iD)("div",n,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(i.Messages,(e=>((0,a.wg)(),(0,a.j4)(l,{key:e,Emotes:i.Emotes,GlobalBadges:i.GlobalBadges,Paints:i.Paints,OtherBadges:i.OtherBadges,defaultColors:i.defaultColors,payload:e,BG:e.BG},null,8,["Emotes","GlobalBadges","Paints","OtherBadges","defaultColors","payload","BG"])))),128))])}var i=s(7139);const r={class:"ChatMessage"},l=["src"],c=["HavePaints"],h=["HavePaints"],d={class:"message-text"},g=["src","ZeroWidth"];function u(e,t,s,n,o,u){return(0,a.wg)(),(0,a.iD)("div",r,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.Badges,(e=>((0,a.wg)(),(0,a.iD)("div",{key:e,class:"Badge"},[(0,a._)("img",{src:e.Url},null,8,l)])))),128)),(0,a._)("span",null,[o.displayName.toLowerCase()==this.payload.source.nick?((0,a.wg)(),(0,a.iD)("span",{key:0,HavePaints:o.HavePaints,class:"message-nick",style:(0,i.j5)({color:u.color,backgroundImage:u.bgImage})},(0,i.zw)(o.displayName)+": ",13,c)):(0,a.kq)("",!0),o.displayName.toLowerCase()!=this.payload.source.nick?((0,a.wg)(),(0,a.iD)("span",{key:1,HavePaints:o.HavePaints,class:"message-nick",style:(0,i.j5)({color:u.color,backgroundImage:u.bgImage})},(0,i.zw)(this.payload.source.nick)+" ("+(0,i.zw)(o.displayName)+"): ",13,h)):(0,a.kq)("",!0),(0,a._)("span",d,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(u.FinalMessage,(e=>((0,a.wg)(),(0,a.iD)(a.HY,{key:e},["emote"==e.Type?((0,a.wg)(),(0,a.iD)("img",{key:0,src:e.Text,ZeroWidth:e.ZeroWidth},null,8,g)):(0,a.kq)("",!0),"text"==e.Type?((0,a.wg)(),(0,a.iD)(a.HY,{key:1},[(0,a.Uk)((0,i.zw)(e.Text),1)],64)):(0,a.kq)("",!0)],64)))),128))])])])}s(2262),s(4506);var p=s(3636),m=s(7167),f=s(9242);const b={name:"ChatMessage",data(){return{EmotesBaseUrl:{"7TV":"https://cdn.7tv.app/emote/{0}/2x.webp",BTTV:"https://cdn.betterttv.net/emote/{0}/2x",FFZ:"https://cdn.frankerfacez.com/emote/{0}/2",TWITCH:""},Paint:null,HavePaints:!1,displayName:"",dot:0,Badges:[],paintsEnabled:this.$route.query.paints||"1",shadowText:this.$route.query.shadowtext||"0",font_size:this.$route.query.font_size||"18",interpolateSize:"0"!=this.$route.query.interpbs}},props:{Emotes:Array,OtherBadges:Array,GlobalBadges:Object,Paints:Array,defaultColors:Array,payload:Object,BG:String},created:async function(){if("PRIVMSG"!=this.payload.command.command)return{};if(this.displayName=this.payload.tags["display-name"],void 0==this.payload.tags["display-name"]&&(this.displayName=this.payload.user),this.payload.tags.badges)for(const[e,t]of Object.entries(this.payload.tags["badges"]))this.GlobalBadges[e]&&this.Badges.push({Url:this.GlobalBadges[e][t]});if(this.OtherBadges)for(const e of this.OtherBadges)e.Users.includes(this.payload.tags["user-id"])&&this.Badges.push({Url:e.Url});if("1"==this.paintsEnabled)for(const e of this.Paints)if(e.users.includes(this.payload.tags["user-id"])){this.HavePaints=!0,this.Paint=e;break}},computed:{color(){let e=this.payload.tags.color;if(this.payload.tags.color||(e=this.defaultColors[Math.floor(Math.random()*this.defaultColors.length)]),"transparent"!=this.BG){let t=p.Z.hexToRgb(e),s=p.Z.hexToRgb(this.BG),a=m.Z.rgb2xyz(t[0],t[1],t[2]),n=m.Z.rgb2xyz(s[0],s[1],s[2]),o=10*m.Z.deltaE00(a[0],a[1],a[2],n[0],n[1],n[2]);if(0==o&&(o=.01),o<.3){let t=p.Z.pSBC(.2,e);return t}}return e},FinalMessage(){let e=`${this.payload.parameters}`,t=p.Z.textToMessageObject(e);if(this.payload.tags.emotes){let s=p.Z.parse_smiles(e,this.payload.tags["emotes"]);for(const[e,a]of Object.entries(s))for(const s in t)t[s].Text.slice(0,-1)==e&&(t[s].Type="emote",t[s].Text=a,t[s].ZeroWidth=!1)}for(const s of this.Emotes)for(const e in t)t[e].Text.slice(0,-1)==s.Name&&(t[e].Type="emote",t[e].Text=this.EmotesBaseUrl[s.Type].replace("{0}",s.ID),t[e].ZeroWidth=s.ZeroWidth);return t},bgImage(){if(!this.Paint)return"";const e=this.Paint.function,t=[];switch(this.Paint.function){case"linear-gradient":t.push(`${this.Paint.angle}deg`);break;case"radial-graient":t.push(this.Paint.shape??"circle");break;case"url":t.push(this.Paint.image_url??"");break}let s="";"URL"!==this.Paint.function&&(s=this.Paint.repeat?"repeating-":"");for(const a of this.Paint.stops){const e=p.Z.DecimalToStringRGBA(a.color);t.push(`${e} ${100*a.at}%`)}return`${s}${e}(${t.join(", ")})`},filterText(){return"1"==this.shadowText?"drop-shadow(-1px 2px 1px #2b2b2b)":""},filter(){try{return this.Paint.drop_shadows.map((e=>`drop-shadow(${e.x_offset}px ${e.y_offset}px ${e.radius}px ${p.Z.DecimalToStringRGBA(e.color)})`)).join(" ")}catch(e){return"1"==this.shadowText?"drop-shadow(-1px 2px 1px #2b2b2b)":""}},paintColor(){return this.Paint?p.Z.DecimalToStringRGBA(this.Paint.color):""},badgeSize(){return this.interpolateSize&&parseInt(this.font_size)?Math.round(.8*parseInt(this.font_size)+4.4).toString()+"px":"18px"},emoteSize(){return this.interpolateSize&&parseInt(this.font_size)?(parseInt(this.font_size)+14).toString()+"px":"32px"},messageSize(){return this.interpolateSize&&parseInt(this.font_size)?Math.round(1.33*parseInt(this.font_size)+7).toString()+"px":"31px"},Font_Size(){return`${this.font_size}px`}}},y=()=>{(0,f.sj)((e=>({"385bf562":e.badgeSize,"4b2e00f3":e.messageSize,fd01ce08:e.Font_Size,"304d6f9a":e.BG,"0bc569cc":e.filterText,"497e0eb8":e.emoteSize,b40eff66:e.filter,f643d80c:e.paintColor})))},w=b.setup;b.setup=w?(e,t)=>(y(),w(e,t)):y;var v=b,E=s(89);const B=(0,E.Z)(v,[["render",u]]);var I=B,T=(s(2087),{async getUserID(e){const t=await fetch(`https://api.ivr.fi/v2/twitch/user?login=${e}`);if(t.ok){console.log("IVR API successful, getting user-id...");const e=await t.json();return e[0].id}throw"Unable to get user id from ivr API!"},async getGlobalBadges(){try{let e={};const t=await fetch("https://badges.twitch.tv/v1/badges/global/display?language=en"),s=await t.json();for(const[a,n]of Object.entries(s["badge_sets"])){let t=n["versions"],s={};for(const[e,a]of Object.entries(t))s[e]=a["image_url_2x"];e[a]=s}return e}catch(e){return console.log(`Unable to get global badges: ${e}`),{}}},async getSubscriberBadges(e){let t={};const s=await fetch(`https://badges.twitch.tv/v1/badges/channels/${e}/display`),a=await s.json();if(s.ok&&Object.keys(a.badge_sets).length>0){let e=a["badge_sets"]["subscriber"]["versions"],s={};for(const[t,a]of Object.entries(e))s[t]=a["image_url_2x"];t=s}return t},async get7tvBadgesPaints(){try{let e=[],t=[];const s=await fetch("https://api.7tv.app/v2/badges?user_identifier=twitch_id"),a=await s.json();for(const n of a["badges"])e.push({Users:n.users,Url:n.urls[1][1]});for(const n of a["paints"])t.push(n);return[e,t]}catch(e){return console.log(`Unable to get 7tv badges: ${e}`),[]}},async get7tvEmotes(e){let t=[];const s=await fetch(`https://7tv.io/v3/users/twitch/${e}`);if(s.ok){const e=await s.json();for(const s of e["emote_set"]["emotes"])t.push({Name:s.name,ID:s.id,Type:"7TV",ZeroWidth:1==s.flags});return[t,e["emote_set"]["id"]]}return console.log("Unable to get 7tv channel emotes"),[]},async get7tvGlobalEmotes(){try{let e=[];const t=await fetch("https://7tv.io/v3/emote-sets/62cdd34e72a832540de95857"),s=await t.json();for(const a of s["emotes"])e.push({Name:a.name,ID:a.id,Type:"7TV",ZeroWidth:1==a.flags});return e}catch(e){return console.log(`Unable to get 7tv global emotes: ${e}`),[]}},async getBttvEmotes(e){try{let t=[];const s=await fetch(`https://api.betterttv.net/3/cached/users/twitch/${e}`),a=await s.json();if(a["sharedEmotes"])for(const e of a["sharedEmotes"])t.push({Name:e.code,ID:e.id,Type:"BTTV"});if(a["channelEmotes"])for(const e of a["channelEmotes"])t.push({Name:e.code,ID:e.id,Type:"BTTV"});return t}catch(t){return console.log(`Unable to get bttv emotes: ${t}`),[]}},async getBttvGlobalEmotes(){try{let e=[];const t=await fetch("https://api.betterttv.net/3/cached/emotes/global"),s=await t.json();for(const a of s)e.push({Name:a.code,ID:a.id,Type:"BTTV"});return e}catch(e){return console.log(`Unable to get bttv global emotes: ${e}`),[]}},async getFfzEmotes(e){try{let t=[];const s=await fetch(`https://api.frankerfacez.com/v1/room/${e}`),a=await s.json();for(const e of a["sets"][a["room"]["set"].toString()]["emoticons"])t.push({Name:e.name,ID:e.id,Type:"FFZ"});return t}catch(t){return console.log(`Unable to get FFZ emotes: ${t}`),[]}},async getFfzGlobalEmotes(){try{let e=[];const t=await fetch("https://api.frankerfacez.com/v1/set/global"),s=await t.json();for(const a of s["sets"]["3"]["emoticons"])e.push({Name:a.name,ID:a.id,Type:"FFZ"});return e}catch(e){return console.log(`Unable to get FFZ emotes: ${e}`),[]}}}),G=T;class k{constructor(e,t,s,a,n){this.ws=null,this.set_id=e,this.user_id=t,this.onDelete=s,this.onAdd=a,this.onRename=n}Connect(){this.ws=new WebSocket("wss://events.7tv.io/v3"),this.ws.onmessage=e=>this.onMessage(e)}subscribeToEvent(e,t){let s={op:35,d:{type:e,condition:t}};this.ws.send(JSON.stringify(s))}onMessage(e){let t=JSON.parse(e.data);switch(t.op){case 1:{this.subscribeToEvent("emote_set.*",{object_id:this.set_id});const e={id:this.user_id,ctx:"channel",platform:"TWITCH"};this.subscribeToEvent("emote_set.*",e);break}case 0:switch(t.d.type){case"emote_set.update":if(t.d.body.pulled)for(const e of t.d.body.pulled){this.onDelete(e);break}if(t.d.body.pushed)for(const e of t.d.body.pushed){this.onAdd(e);break}if(t.d.body.updated)for(const e of t.d.body.updated){this.onRename(e);break}}}}}var O=k;function C(e){const t={"client-nonce":null,flags:null};let s={},a=e.split(";");return a.forEach((e=>{let a=e.split("="),n=""===a[1]?null:a[1];switch(a[0]){case"badges":case"badge-info":if(n){let e={},t=n.split(",");t.forEach((t=>{let s=t.split("/");e[s[0]]=s[1]})),s[a[0]]=e}else s[a[0]]=null;break;case"emotes":if(n){let e={},t=n.split("/");t.forEach((t=>{let s=t.split(":"),a=[],n=s[1].split(",");n.forEach((e=>{let t=e.split("-");a.push({startPosition:t[0],endPosition:t[1]})})),e[s[0]]=a})),s[a[0]]=e}else s[a[0]]=null;break;case"emote-sets":{let e=n.split(",");s[a[0]]=e;break}default:Object.prototype.hasOwnProperty.call(t,a[0])||(s[a[0]]=n)}})),s}function D(e){let t=null,s=e.split(" ");switch(s[0]){case"JOIN":case"PART":case"NOTICE":case"CLEARCHAT":case"CLEARMSG":case"HOSTTARGET":case"PRIVMSG":t={command:s[0],channel:s[1]};break;case"PING":t={command:s[0]};break;case"CAP":t={command:s[0],isCapRequestEnabled:"ACK"===s[2]};break;case"GLOBALUSERSTATE":t={command:s[0]};break;case"USERSTATE":case"ROOMSTATE":t={command:s[0],channel:s[1]};break;case"RECONNECT":t={command:s[0]};break;case"421":return null;case"001":t={command:s[0],channel:s[1]};break;case"002":case"003":case"004":case"353":case"366":case"372":case"375":case"376":return null;default:return null}return t}function P(e){if(null==e)return null;{let t=e.split("!");return{nick:2==t.length?t[0]:null,host:2==t.length?t[1]:t[0]}}}function x(e,t){let s=0,a=e.slice(s+1).trim(),n=a.indexOf(" ");return-1==n?t.botCommand=a.slice(0):(t.botCommand=a.slice(0,n),t.botCommandParams=a.slice(n).trim()),t}var _={parseMessage(e){let t={tags:null,source:null,command:null,parameters:null},s=0,a=null,n=null,o=null,i=null;if("@"===e[s]){let t=e.indexOf(" ");a=e.slice(1,t),s=t+1}if(":"===e[s]){s+=1;let t=e.indexOf(" ",s);n=e.slice(s,t),s=t+1}let r=e.indexOf(":",s);return-1==r&&(r=e.length),o=e.slice(s,r).trim(),r!=e.length&&(s=r+1,i=e.slice(s)),t.command=D(o),null==t.command?null:(null!=a&&(t.tags=C(a)),t.source=P(n),t.parameters=i,i&&"!"===i[0]&&(t.command=x(i,t.command)),t.parameters&&(t.parameters=t.parameters.replace("ACTION",""),t.parameters=t.parameters.replace("","")),t)}},S=_;class M{constructor(e){this.ws=null,this.IsDisconnected=!1,this.channel=e,this.channelID=null,this.OnUserId=null,this.OnPrivateMessage=null,this.OnClearChat=null,this.OnClearMessage=null}connect(){this.IsDisconnected||(this.ws=new WebSocket("wss://irc-ws.chat.twitch.tv:443"),this.ws.onmessage=e=>this.onMessage(e),this.ws.onopen=()=>this.onOpen(),this.ws.onerror=()=>this.onError(),this.ws.onclose=()=>this.onClose())}async onError(){console.log("Connection error occured, disconnecting..."),this.ws.close()}async onClose(){console.log("Disconnected, attempting to reconnect..."),this.IsDisconnected=!0,setInterval((()=>{this.connect()}),1e3)}async onOpen(){console.log("1232132312"),this.IsDisconnected=!1,this.ws.send("NICK justinfan1337"),this.ws.send("JOIN #"+this.channel.toLowerCase()),this.ws.send("CAP REQ :twitch.tv/tags twitch.tv/commands")}async onMessage(e){let t=e.data.split("\r\n");t.forEach((e=>{let t=S.parseMessage(e);if(t)switch(t.command.command){case"CLEARCHAT":this.OnClearChat(t);break;case"CLEARMSG":this.OnClearMessage(t);break;case"PRIVMSG":null==this.channelID&&(this.channelID=t.tags["room-id"],this.OnUserId(t.tags["room-id"])),this.OnPrivateMessage(t);break;case"PING":this.ws.send(`PONG ${t.message}`)}}))}}var z={name:"chat-page",components:{ChatMessage:I},data(){return{EventApi:null,paintsEnabled:this.$route.query.paints||"1",font_size:this.$route.query.font_size||"18",altBG:"0"!=this.$route.query.altbg,BG:this.$route.query.background||"#2b2b2b",BG2:"",useEventAPI:"0"!=this.$route.query.eventapi,channel:this.$route.query.channel,currBG:!0,IsDisconnected:!1,Emotes:[],GlobalBadges:[],OtherBadges:[],Paints:[],channelID:null,client:null,Messages:[],defaultColors:["#4242f7","#ff7f50","#1e90ff","#00ff7f","#9acd32","#008000","#ff4500","#ff0000","#daa520","#ff69b4","#5f9ea0","#2e8b57","#d2691e","#a065d7","#b22222"]}},updated(){window.scrollTo(0,document.body.scrollHeight),this.Messages.length>50&&this.Messages.shift()},methods:{onEmoteDelete(e){this.Emotes=this.Emotes.filter((t=>t.ID!==e.old_value.id))},onEmoteAdd(e){this.Emotes.push({Name:e.value.name,ID:e.value.id,Type:"7TV"})},onEmoteRename(e){for(let t of this.Emotes)t.ID==e.value.id&&(t.Name=e.value.name);this.Emotes.push({Name:e.value.name,ID:e.value.id,Type:"7TV"})},async onUserID(e){if(console.log(this.channelID),null==this.channelID){this.channelID=e;let t=await G.getSubscriberBadges(this.channelID);t&&(this.GlobalBadges["subscriber"]=t,console.log("loaded sub badges"));let s=await G.get7tvEmotes(this.channelID);console.log("loaded seventv channel"),this.Emotes=this.Emotes.concat(s[0]),this.Emotes=this.Emotes.concat(await G.getBttvEmotes(this.channelID)),this.useEventAPI&&(this.EventApi=new O(s[1],this.channelID,this.onEmoteDelete,this.onEmoteAdd,this.onEmoteRename),this.EventApi.Connect())}}},created:async function(){if("#2b2b2b"!=this.BG&&"transparent"!=this.BG&&(this.BG="#"+this.BG),this.altBG&&"transparent"!=this.BG){let e=1,t=p.Z.toGray(this.BG);t>.38&&(e=-30/t),this.BG2=p.Z.pSBC(.01*e,this.BG)}else"transparent"==this.BG&&(this.BG2="transparent");this.client=new M(this.channel),this.client.OnUserId=this.onUserID,this.client.OnPrivateMessage=async e=>{e.BG=this.BG,this.altBG&&(e.BG=this.currBG?this.BG:this.BG2,this.currBG=!this.currBG),this.Messages.push(e)},this.client.OnClearChat=async e=>{this.Messages=this.Messages.filter((t=>t.source.nick!==e.parameters))},this.client.OnClearMessage=async e=>{this.Messages=this.Messages.filter((t=>t.tags["id"]!==e.tags["target-msg-id"]))},this.client.connect();try{let e=await G.getUserID(this.channel);await this.onUserID(e)}catch(s){}this.Emotes=this.Emotes.concat(await G.get7tvGlobalEmotes()),console.log("loaded 7tv global emotes"),this.Emotes=this.Emotes.concat(await G.getBttvGlobalEmotes()),console.log("loaded bttv global emotes"),this.Emotes=this.Emotes.concat(await G.getFfzEmotes(this.channel)),console.log("loaded ffz channel emotes"),this.Emotes=this.Emotes.concat(await G.getFfzGlobalEmotes()),console.log("loaded ffz global emotes");let e=await G.getGlobalBadges();this.GlobalBadges["subscriber"]&&(e["subscriber"]=this.GlobalBadges["subscriber"]),this.GlobalBadges=e;let t=await G.get7tvBadgesPaints();this.OtherBadges=t[0],this.OtherBadges.unshift({Users:["407046453"],Url:"https://i.imgur.com/qgO1Y7A.png"}),this.OtherBadges.unshift({Users:["521810742"],Url:"https://cdn.7tv.app/emote/63d6ed00349f81ba10452fdd/2x.webp"}),this.OtherBadges.unshift({Users:["69078167"],Url:"https://i.imgur.com/nIm3MvW.gif"}),this.OtherBadges.unshift({Users:["489131898"],Url:"https://i.imgur.com/Kg7X4ga.gif"}),this.Paints=t[1]}};const U=(0,E.Z)(z,[["render",o]]);var A=U}}]);
//# sourceMappingURL=788.4fd4727e.js.map