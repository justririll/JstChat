"use strict";(self["webpackChunkchat"]=self["webpackChunkchat"]||[]).push([[890],{7890:function(e,t,s){s.r(t),s.d(t,{default:function(){return F}});var i=s(3396),a=s(9242);const o={id:"chat"};function n(e,t,s,n,r,d){const h=(0,i.up)("ChatMessage"),l=(0,i.Q2)("emoji");return(0,i.wg)(),(0,i.iD)("div",o,[(0,i.Wm)(a.W3,{name:d.transition_group},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.Messages,(e=>(0,i.wy)(((0,i.wg)(),(0,i.j4)(h,{key:e.tags.id,PersonalEmotes:r.PersonalEmotes[e.source.nick],Emotes:r.Emotes,GlobalBadges:r.GlobalBadges,Paints:r.Paints,OtherBadges:r.OtherBadges,defaultColors:r.defaultColors,payload:e,BG:e.BG,overridedBadges:r.overridedBadges},null,8,["PersonalEmotes","Emotes","GlobalBadges","Paints","OtherBadges","defaultColors","payload","BG","overridedBadges"])),[[l]]))),128))])),_:1},8,["name"])])}const r={class:"ChatMessage"};function d(e,t,s,a,o,n){const d=(0,i.up)("Badges"),h=(0,i.up)("Nick"),l=(0,i.up)("Message");return(0,i.wg)(),(0,i.iD)("div",r,[(0,i.Wm)(d,{Badges:this.Badges},null,8,["Badges"]),(0,i._)("span",null,[(0,i.Wm)(h,{Tags:this.payload.tags,color:n.color,Login:this.payload.source.nick,HavePaints:null!=this.Paint,id:s.payload.tags.id},null,8,["Tags","color","Login","HavePaints","id"]),(0,i.Wm)(l,{HavePaints:(null!=this.Paint).toString(),Emotes:s.Emotes,twEmotes:n.TwitchEmotes,pEmotes:s.PersonalEmotes,Parameters:s.payload.parameters,Action:s.payload.action,color:this.color,id:s.payload.tags.id},null,8,["HavePaints","Emotes","twEmotes","pEmotes","Parameters","Action","color","id"])])])}s(2262),s(4506);var h=s(9065),l=s(7662),c=s(7139);const g=["id","action","HavePaints"];function u(e,t,s,a,o,n){const r=(0,i.Q2)("emotes"),d=(0,i.Q2)("twitch-emotes"),h=(0,i.Q2)("personal-emotes");return(0,i.wy)(((0,i.wg)(),(0,i.iD)("span",{id:"mes-"+s.id,class:"message-text",action:s.Action,HavePaints:s.HavePaints},[(0,i.Uk)((0,c.zw)(s.Parameters),1)],8,g)),[[r,s.Emotes],[d,s.twEmotes],[h,s.pEmotes]])}const p={name:"MessageText",data(){return{interpolateSize:"0"!=this.$route.query.interpbs,font_size:this.$route.query.font_size||"18"}},props:{HavePaints:String,Emotes:Object,pEmotes:Array,twEmotes:Object,Parameters:String,Action:Boolean,color:String,id:String},computed:{emoteSize(){return"1"==this.interpolateSize&&parseInt(this.font_size)?(parseInt(this.font_size)+14).toString()+"px":"32px"},Font_Size(){return`${this.font_size}px`}},watch:{HavePaints(){document.getElementById("mes-"+this.id).setAttribute("HavePaints",this.HavePaints)}}},m=()=>{(0,a.sj)((e=>({"05f71d64":e.color,c0d09938:e.filterText,"5fd941cc":e.emoteSize})))},b=p.setup;p.setup=b?(e,t)=>(m(),b(e,t)):m;var f=p,B=s(89);const v=(0,B.Z)(f,[["render",u]]);var y=v;const E=["id","HavePaints"];function P(e,t,s,a,o,n){return(0,i.wg)(),(0,i.iD)("span",{id:"nick-"+s.id,HavePaints:s.HavePaints,class:"message-nick",style:(0,c.j5)({color:s.color})},(0,c.zw)(n.nick)+": ",13,E)}var w={name:"MessageNick",data(){return{displayName:""}},props:{HavePaints:Boolean,Login:String,Tags:Object,id:String,color:String},created(){this.displayName=this.Tags["display-name"],void 0==this.Tags["display-name"]&&(this.displayName=this.Login)},computed:{nick(){return this.displayName.toLowerCase()!=this.Login?`${this.Login} (${this.displayName})`:this.displayName}},watch:{HavePaints(){document.getElementById("nick-"+this.id).setAttribute("HavePaints",this.HavePaints.toString())}}};const G=(0,B.Z)(w,[["render",P]]);var A=G;const O=["provider","src"];function k(e,t,s,a,o,n){return(0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(s.Badges,(e=>((0,i.wg)(),(0,i.iD)("div",{key:e,class:"Badge"},[(0,i._)("img",{provider:e.provider,src:e.Url},null,8,O)])))),128)}var I={name:"MessageBadges",props:{Badges:Array}};const T=(0,B.Z)(I,[["render",k]]);var D=T;const C={name:"ChatMessage",components:{Message:y,Nick:A,Badges:D},data(){return{EmotesBaseUrl:{"7TV":"https://cdn.7tv.app/emote/{0}/2x.webp",BTTV:"https://cdn.betterttv.net/emote/{0}/2x",FFZ:"https://cdn.frankerfacez.com/emote/{0}/2",TWITCH:""},HavePaints:!1,displayName:"",Badges:[],dot:0,smoothColors:this.$route.query.smoothcolor||"1",paintsEnabled:this.$route.query.paints||"1",shadowText:this.$route.query.shadowtext||"0",font_size:this.$route.query.font_size||"18",interpolateSize:"0"!=this.$route.query.interpbs,border:this.$route.query.border||"2",padding:this.$route.query.padding||"1"}},props:{PersonalEmotes:Array,Emotes:Object,OtherBadges:Array,GlobalBadges:Object,Paints:Array,overridedBadges:Boolean,defaultColors:Array,payload:Object,BG:String},created:async function(){if("PRIVMSG"!=this.payload.command.command)return{};if(this.payload.tags.badges)for(const[e,t]of Object.entries(this.payload.tags["badges"]))if(this.GlobalBadges[e]){let s="Twitch";this.overridedBadges&&"moderator"==e&&(s="ffz-mod-badge"),void 0!=this.GlobalBadges[e][t]&&this.Badges.push({Url:this.GlobalBadges[e][t],provider:s})}if(this.OtherBadges)for(const e of this.OtherBadges)e.Users.includes(this.payload.tags["user-id"])&&this.Badges.push({Url:e.Url,provider:"none"})},computed:{color(){let e=this.payload.tags.color;if(this.payload.tags.color||(e=this.defaultColors[Math.floor(Math.random()*this.defaultColors.length)]),"transparent"!=this.BG&&"1"==this.smoothColors){let t=l.Z.hexToRgb(e),s=l.Z.hexToRgb(this.BG),i=h.Z.rgb2xyz(t[0],t[1],t[2]),a=h.Z.rgb2xyz(s[0],s[1],s[2]),o=10*h.Z.deltaE00(i[0],i[1],i[2],a[0],a[1],a[2]);if(0==o&&(o=1e-4),o<.3){let t=l.Z.pSBC(.25,e);return t}}return e},Paint(){if("1"==this.paintsEnabled)for(const e of this.Paints)if(e.users.includes(this.payload.tags["user-id"]))return e;return null},TwitchEmotes(){return this.payload.tags.emotes?l.Z.parse_smiles(this.payload.parameters,this.payload.tags["emotes"]):{}},bgImage(){if(!this.Paint)return"";let e="";const t=[];switch(this.Paint.function){case"LINEAR_GRADIENT":e="linear-gradient",t.push(`${this.Paint.angle}deg`);break;case"RADIAL_GRADIENT":e="radial-gradient",t.push(this.Paint.shape??"circle");break;case"URL":e="url-gradient",t.push(this.Paint.image_url??"");break}let s="";"URL"!==this.Paint.function&&(s=this.Paint.repeat?"repeating-":"");for(const i of this.Paint.stops){const e=l.Z.DecimalToStringRGBA(i.color);t.push(`${e} ${100*i.at}%`)}return`${s}${e}(${t.join(", ")})`},filterText(){return"1"==this.shadowText?"drop-shadow(1px 2px 1px #2b2b2b)":""},filter(){try{return this.Paint.shadows.map((e=>`drop-shadow(${e.x_offset}px ${e.y_offset}px ${e.radius}px ${l.Z.DecimalToStringRGBA(e.color)})`)).join(" ")}catch(e){return""}},paintColor(){return this.Paint?l.Z.DecimalToStringRGBA(this.Paint.color):""},badgeSize(){return this.interpolateSize&&parseInt(this.font_size)?Math.round(.8*parseInt(this.font_size)+4.4).toString()+"px":"18px"},messageSize(){return this.interpolateSize&&parseInt(this.font_size)?Math.round(1.33*parseInt(this.font_size)+7).toString()+"px":"31px"},Font_Size(){return`${this.font_size}px`},Border(){return`${this.border}px solid black`},Padding(){return"1"==this.padding?"3px":"0px"}},methods:{}},_=()=>{(0,a.sj)((e=>({"32c218a0":e.badgeSize,"7776cc5d":e.Padding,"630e49d8":e.messageSize,f767f146:e.Font_Size,"20db7c59":e.BG,"160caa60":e.Border,"5324158c":e.filter,"48a21c8e":e.paintColor,"386b8882":e.bgImage})))},z=C.setup;C.setup=z?(e,t)=>(_(),z(e,t)):_;var S=C;const Z=(0,B.Z)(S,[["render",d]]);var $=Z,j=s(7167);class x{constructor(e,t){this.ws=null,this.set_id=e,this.user_id=t,this.onDelete=void 0,this.onAdd=void 0,this.onRename=void 0,this.onBadgeCreate=void 0,this.onBadgeDelete=void 0,this.onPaintCreate=void 0,this.onPaintDelete=void 0,this.pending={},this.onPersonalEmotes=void 0,this.IsDisconnected=!0,this.IsReconnecting=!1,this.Timeout=1e3,this.attemps=0}Connect(){this.IsDisconnected&&(this.ws=new WebSocket("wss://events.7tv.io/v3"),this.ws.onmessage=e=>this.onMessage(e),this.ws.onclose=()=>this.onClose(),this.ws.onopen=()=>this.onOpen(),this.ws.onerror=()=>{this.ws.close()},this.IsReconnecting=!1)}async onOpen(){this.IsDisconnected=!1,console.log("EVENT API connected")}async onClose(){this.IsReconnecting||(this.IsReconnecting=!0,console.log("EVENT API disconnected"),this.IsDisconnected=!0,this.attemps++,setTimeout((()=>{this.Connect()}),this.Timeout*this.attemps))}subscribeToEvent(e,t){let s={op:35,d:{type:e,condition:t}};this.ws.send(JSON.stringify(s))}getTwitchConnection(e){for(const t of e)if("TWITCH"==t.platform)return t}async onMessage(e){let t=JSON.parse(e.data);switch(t.op){case 4011:console.log(t),this.ws.close(),this.Connect();break;case 1:{this.subscribeToEvent("emote_set.*",{object_id:this.set_id});const e={id:this.user_id,ctx:"channel",platform:"TWITCH"};this.subscribeToEvent("emote_set.*",e),this.subscribeToEvent("cosmetic.*",e),this.subscribeToEvent("entitlement.*",e);break}case 0:switch(t.d.type){case"emote_set.update":if(t.d.body.pulled)for(const e of t.d.body.pulled){this.onDelete(e);break}if(t.d.body.pushed)for(const e of t.d.body.pushed){this.onAdd(e);break}if(t.d.body.updated)for(const e of t.d.body.updated){this.onRename(e);break}break;case"emote_set.create":{if("Personal Emotes"!=t.d.body.object.name)break;let e=t.d.body.object.id;this.onPersonalEmotes(...await j.Z.get7tvEmoteSet(e));break}case"cosmetic.create":switch(t.d.body.object.kind){case"PAINT":this.pending[t.d.body.object.id]=t.d.body.object;break;case"BADGE":this.pending[t.d.body.object.id]=t.d.body.object;break}break;case"entitlement.create":{let e=this.pending[t.d.body.object.ref_id];if(void 0==e)break;switch(e.kind){case"PAINT":e.user=this.getTwitchConnection(t.d.body.object.user.connections),this.onPaintCreate(e);break;case"BADGE":e.user=this.getTwitchConnection(t.d.body.object.user.connections),this.onBadgeCreate(e);break}break}case"entitlement.delete":{let e=this.pending[t.d.body.object.ref_id];if(void 0==e)break;switch(e.kind){case"PAINT":e.user=this.getTwitchConnection(t.d.body.object.user.connections),this.onPaintDelete(e);break;case"BADGE":e.user=this.getTwitchConnection(t.d.body.object.user.connections),this.onBadgeDelete(e);break}break}}}}}var R=x,M=s(4598),U=s(6007);const H={name:"chat-page",components:{ChatMessage:$},data(){return{EventApi:null,paintsEnabled:this.$route.query.paints||"1",font_size:this.$route.query.font_size||"18",altBG:"0"!=this.$route.query.altbg,BG:this.$route.query.background||"#2b2b2b",BG2:"",useEventAPI:"0"!=this.$route.query.eventapi,pEmotesEnabled:"0"!=this.$route.query.pemotes,deleteAfter:this.$route.query.deleteafter||"0",fontName:this.$route.query.fontname||"roboto",ignoreList:(this.$route.query.ignore||"").toLowerCase().split(" "),PersonalEmotes:{},channel:this.$route.query.channel,currBG:!0,IsDisconnected:!1,Emotes:{},GlobalBadges:[],OtherBadges:[],Paints:[],channelID:null,client:null,overridedBadges:!1,Messages:[],defaultColors:["#4242f7","#ff7f50","#1e90ff","#00ff7f","#9acd32","#008000","#ff4500","#ff0000","#daa520","#ff69b4","#5f9ea0","#2e8b57","#d2691e","#a065d7","#b22222"]}},methods:{onPaintCreate(e){for(const s in this.Paints)if(void 0!=this.Paints[s]&&this.Paints[s].name==e.data.name)return void this.Paints[s].users.push(e.user.id);let t=this.Paints.push(e.data)-1;this.Paints[t].users=[e.user.id]},onPaintDelete(e){for(const t in this.Paints)if(this.Paints[t].id==e.data.id){this.Paints[t].users=this.Paints[t].users.filter((function(t){return t!==e.user.id}));break}},onBadgeCreate(e){for(const s in this.OtherBadges)if(void 0!=this.OtherBadges[s]&&this.OtherBadges[s].id==e.data.id)return void this.OtherBadges[s].Users.push(e.user.id);let t=this.OtherBadges.push({Url:`https:${e.data.host.url}/2x`,id:e.data.id})-1;this.OtherBadges[t].Users=[e.user.id]},onBadgeDelete(e){for(const t in this.OtherBadges)if(this.OtherBadges[t].id==e.data.id){this.OtherBadges[t].Users=this.OtherBadges[t].Users.filter((function(t){return t!==e.user.id}));break}},onEmoteDelete(e){delete this.Emotes[e.old_value.name]},onEmoteAdd(e){this.Emotes[e.value.name]={ID:e.value.id,Type:"7TV"}},onEmoteRename(e){console.log(e),this.Emotes[e.value.name]=this.Emotes[e.old_value.name],delete this.Emotes[e.old_value.name]},onPersonalEmotes(e,t){void 0!=e&&void 0!=t&&this.pEmotesEnabled&&(this.PersonalEmotes[t]=e)},async get7tvchannel(){let e=await j.Z.RetryOnError(j.Z.get7tvEmotes,[this.channelID],3);e.length>0&&(console.log("loaded seventv channel"),this.Emotes=Object.assign(this.Emotes,e[0]),this.useEventAPI&&(this.EventApi=new R(e[1],this.channelID,this.onEmoteAdd,this.onEmoteRename),this.EventApi.onDelete=this.onEmoteDelete,this.EventApi.onAdd=this.onEmoteAdd,this.EventApi.onRename=this.onEmoteRename,this.EventApi.onBadgeCreate=this.onBadgeCreate,this.EventApi.onBadgeDelete=this.onBadgeDelete,this.EventApi.onPaintCreate=this.onPaintCreate,this.EventApi.onPaintDelete=this.onPaintDelete,this.EventApi.onPersonalEmotes=this.onPersonalEmotes,this.EventApi.Connect()))},async getbttvchannel(){this.Emotes=Object.assign(this.Emotes,await j.Z.RetryOnError(j.Z.getBttvEmotes,[this.channelID],3))},async getsubscriberbadges(){let e=await j.Z.RetryOnError(j.Z.getSubscriberBadges,[this.channelID],3);e&&(this.GlobalBadges["subscriber"]=e,console.log("loaded sub badges"))},async onUserID(e){console.log(this.channelID),null==this.channelID&&(this.channelID=e,await this.getbttvchannel(),await this.get7tvchannel(),await this.getsubscriberbadges())}},created:async function(){if((0,U.u)({link:[{href:`https://fonts.googleapis.com/css2?family=${this.$route.query.fontname||"Roboto"}&display=swap`,rel:"stylesheet"}]}),"#2b2b2b"!=this.BG&&"transparent"!=this.BG&&(this.BG="#"+this.BG),this.altBG&&"transparent"!=this.BG){let e=1,t=l.Z.toGray(this.BG);t>.38&&(e=-30/t),this.BG2=l.Z.pSBC(.01*e,this.BG)}else"transparent"==this.BG&&(this.BG2="transparent");this.client=new M.Z(this.channel),this.client.OnUserId=this.onUserID,this.client.OnPrivateMessage=async e=>{this.ignoreList.includes(e.source.nick)||(e.BG=this.BG,this.altBG&&(e.BG=this.currBG?this.BG:this.BG2,this.currBG=!this.currBG),this.Messages.push(e),"0"!=this.deleteAfter&&setTimeout((e=>{this.Messages=this.Messages.filter((t=>t.tags["id"]!==e))}),1e3*parseInt(this.deleteAfter),e.tags.id.slice()),this.Messages.length>50&&this.Messages.shift())},this.client.OnClearChat=async e=>{this.Messages=this.Messages.filter((t=>t.source.nick!==e.parameters))},this.client.OnClearMessage=async e=>{this.Messages=this.Messages.filter((t=>t.tags["id"]!==e.tags["target-msg-id"]))},this.client.connect();try{let e=await j.Z.getUserID(this.channel);console.log(e),await this.onUserID(e)}catch(s){}this.Emotes=Object.assign(this.Emotes,await j.Z.RetryOnError(j.Z.get7tvGlobalEmotes,[],3)),console.log("loaded 7tv global emotes"),this.Emotes=Object.assign(this.Emotes,await j.Z.RetryOnError(j.Z.getBttvGlobalEmotes,[],3)),console.log("loaded bttv global emotes");let e=await j.Z.RetryOnError(j.Z.getFfzEmotes,[this.channel],3);void 0!=e[0]&&(this.Emotes=Object.assign(this.Emotes,e[0])),console.log("loaded ffz channel emotes"),this.Emotes=Object.assign(this.Emotes,await j.Z.RetryOnError(j.Z.getFfzGlobalEmotes,[],3)),console.log("loaded ffz global emotes");let t=await j.Z.RetryOnError(j.Z.getGlobalBadges,[],3);this.GlobalBadges["subscriber"]&&(t["subscriber"]=this.GlobalBadges["subscriber"]),this.GlobalBadges=t,void 0!=e[1]&&(this.GlobalBadges["moderator"]["1"]=e[1],this.overridedBadges=!0),void 0!=e[2]&&(this.GlobalBadges["vip"]["1"]=e[2]),this.OtherBadges=[],this.OtherBadges.unshift({Users:["407046453"],Url:"https://i.imgur.com/qgO1Y7A.png"}),this.OtherBadges.unshift({Users:["521810742"],Url:"https://cdn.7tv.app/emote/63d6ed00349f81ba10452fdd/2x.webp"}),this.OtherBadges.unshift({Users:["69078167"],Url:"https://i.imgur.com/nIm3MvW.gif"}),this.OtherBadges.unshift({Users:["489131898"],Url:"https://i.imgur.com/Kg7X4ga.gif"}),this.Paints=[]},computed:{transition_group(){return"0"!=this.deleteAfter?"tr":"fl"}}},N=()=>{(0,a.sj)((e=>({be93f9a2:e.fontName})))},q=H.setup;H.setup=q?(e,t)=>(N(),q(e,t)):N;var L=H;const W=(0,B.Z)(L,[["render",n]]);var F=W}}]);
//# sourceMappingURL=890.2e2c0a79.js.map